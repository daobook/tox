
<!DOCTYPE html>

<html lang="zh_CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>General tips and tricks &#8212; tox 0.1.dev1 文档</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/translations.js"></script>
    <link rel="shortcut icon" href="../_static/toxfavi.ico"/>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="Using tox with the Jenkins Integration Server" href="jenkins.html" />
    <link rel="prev" title="Generate documentation" href="documentation.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="general-tips-and-tricks">
<h1>General tips and tricks<a class="headerlink" href="#general-tips-and-tricks" title="永久链接至标题">¶</a></h1>
<section id="interactively-passing-positional-arguments">
<h2>Interactively passing positional arguments<a class="headerlink" href="#interactively-passing-positional-arguments" title="永久链接至标题">¶</a></h2>
<p>If you invoke <code class="docutils literal notranslate"><span class="pre">tox</span></code> like this:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>tox -- -x tests/test_something.py
</pre></div>
</div>
<p>the arguments after the <code class="docutils literal notranslate"><span class="pre">--</span></code> will be substituted
everywhere where you specify <code class="docutils literal notranslate"><span class="pre">{posargs}</span></code> in your
test commands, for example using <code class="docutils literal notranslate"><span class="pre">pytest</span></code>:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[testenv]</span><span class="w"></span>
<span class="c1"># Could also be in a specific ``[testenv:&lt;NAME&gt;]`` section</span><span class="w"></span>
<span class="na">commands</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">pytest {posargs}</span><span class="w"></span>
</pre></div>
</div>
<p>or using <code class="docutils literal notranslate"><span class="pre">nosetests</span></code>:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[testenv]</span><span class="w"></span>
<span class="na">commands</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">nosetests {posargs}</span><span class="w"></span>
</pre></div>
</div>
<p>the above <code class="docutils literal notranslate"><span class="pre">tox</span></code> invocation will trigger the test runners to
stop after the first failure and to only run a particular test file.</p>
<p>You can specify defaults for the positional arguments using this
syntax:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[testenv]</span><span class="w"></span>
<span class="na">commands</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">nosetests {posargs:--with-coverage}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="dependency-changes-and-tracking">
<span id="recreate"></span><h2>Dependency changes and tracking<a class="headerlink" href="#dependency-changes-and-tracking" title="永久链接至标题">¶</a></h2>
<p>Creating virtual environments and installing dependencies is an expensive operation.
Therefore tox tries to avoid it whenever possible, meaning it will never perform this
unless it detects with absolute certainty that it needs to perform an update. A tox
environment creation is made up of:</p>
<ul class="simple">
<li><p>create the virtual environment</p></li>
<li><p>install dependencies specified inside deps</p></li>
<li><p>if it’s a library project (has build package phase), install library dependencies
(with potential extras)</p></li>
</ul>
<p>These three steps are only performed once (given they all succeeded). Subsequent calls
that don’t detect changes to the traits of that step will not alter the virtual
environment in any way. When a change is detected for any of the steps, the entire
virtual environment is removed and the operation starts from scratch (this is
because it’s very hard to determine what would the delta changes would be needed -
e.g. a dependency could migrate from one dependency to another, and in this case
we would need to install the new while removing the old one).</p>
<p>Here’s what traits we track at the moment for each steps:</p>
<ul class="simple">
<li><p>virtual environment trait is tied to the python path the <a class="reference internal" href="../config.html#conf-basepython"><code class="xref std std-conf docutils literal notranslate"><span class="pre">basepython</span></code></a>
resolves too (if this config changes, the virtual environment will be recreated),</p></li>
<li><p><a class="reference internal" href="../config.html#conf-deps"><code class="xref std std-conf docutils literal notranslate"><span class="pre">deps</span></code></a> sections changes (meaning any string-level change for the entries, note
requirement file content changes are not tracked),</p></li>
<li><p>library dependencies are tracked at <a class="reference internal" href="../config.html#conf-extras"><code class="xref std std-conf docutils literal notranslate"><span class="pre">extras</span></code></a> level (because there’s no
Python API to enquire about the actual dependencies in a non-tool specific way,
e.g. setuptools has one way, flit something else, and poetry another).</p></li>
</ul>
<p>Whenever you change traits that are not tracked we recommend you to manually trigger a
rebuild of the tox environment by passing the <code class="docutils literal notranslate"><span class="pre">-r</span></code> flag for the tox invocation. For
instance, for a setuptools project whenever you modify the <code class="docutils literal notranslate"><span class="pre">install_requires</span></code> keyword
at the next run force the recreation of the tox environment by passing the recreate cli
tox flag.</p>
</section>
<section id="selecting-one-or-more-environments-to-run-tests-against">
<span id="toxenv"></span><h2>Selecting one or more environments to run tests against<a class="headerlink" href="#selecting-one-or-more-environments-to-run-tests-against" title="永久链接至标题">¶</a></h2>
<p>Using the <code class="docutils literal notranslate"><span class="pre">-e</span> <span class="pre">ENV[,ENV36,...]</span></code>  option you explicitly list
the environments where you want to run tests against. For
example, given the previous sphinx example you may call:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>tox -e docs
</pre></div>
</div>
<p>which will make <code class="docutils literal notranslate"><span class="pre">tox</span></code> only manage the <code class="docutils literal notranslate"><span class="pre">docs</span></code> environment
and call its test commands.  You may specify more than
one environment like this:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>tox -e py27,py36
</pre></div>
</div>
<p>which would run the commands of the <code class="docutils literal notranslate"><span class="pre">py27</span></code> and <code class="docutils literal notranslate"><span class="pre">py36</span></code> testenvironments
respectively.  The special value <code class="docutils literal notranslate"><span class="pre">ALL</span></code> selects all environments.</p>
<p>You can also specify an environment list in your <code class="docutils literal notranslate"><span class="pre">tox.ini</span></code>:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[tox]</span><span class="w"></span>
<span class="na">envlist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">py27,py36</span><span class="w"></span>
</pre></div>
</div>
<p>or override it from the command line or from the environment variable
<code class="docutils literal notranslate"><span class="pre">TOXENV</span></code>:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">TOXENV</span><span class="o">=</span>py27,py36 <span class="c1"># in bash style shells</span>
</pre></div>
</div>
</section>
<section id="access-package-artifacts-between-multiple-tox-runs">
<span id="artifacts"></span><h2>Access package artifacts between multiple tox-runs<a class="headerlink" href="#access-package-artifacts-between-multiple-tox-runs" title="永久链接至标题">¶</a></h2>
<p>If you have multiple projects using tox you can make use of
a <code class="docutils literal notranslate"><span class="pre">distshare</span></code> directory where <code class="docutils literal notranslate"><span class="pre">tox</span></code> will copy in sdist-packages so
that another tox run can find the “latest” dependency.  This feature
allows you to test a package against an unreleased development version
or even an uncommitted version on your own machine.</p>
<p>By default, <code class="docutils literal notranslate"><span class="pre">{homedir}/.tox/distshare</span></code> will be used for
copying in and copying out artifacts (i.e. Python packages).</p>
<p>For project <code class="docutils literal notranslate"><span class="pre">two</span></code> to depend on the <code class="docutils literal notranslate"><span class="pre">one</span></code> package you use
the following entry:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="c1"># example two/tox.ini</span><span class="w"></span>
<span class="k">[testenv]</span><span class="w"></span>
<span class="c1"># install latest package from &quot;one&quot; project</span><span class="w"></span>
<span class="na">deps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">{distshare}/one-*.zip</span><span class="w"></span>
</pre></div>
</div>
<p>That’s all.  tox running on project <code class="docutils literal notranslate"><span class="pre">one</span></code> will copy the sdist-package
into the <code class="docutils literal notranslate"><span class="pre">distshare</span></code> directory after which a <code class="docutils literal notranslate"><span class="pre">tox</span></code> run on project
<code class="docutils literal notranslate"><span class="pre">two</span></code> will grab it because <code class="docutils literal notranslate"><span class="pre">deps</span></code> contain an entry with the
<code class="docutils literal notranslate"><span class="pre">one-*.zip</span></code> pattern.  If there is more than one matching package the
highest version will be taken.  <code class="docutils literal notranslate"><span class="pre">tox</span></code> uses <a class="reference external" href="https://bitbucket.org/tarek/distutilsversion/">verlib</a>  to compare version
strings which must be compliant with <span class="target" id="index-0"></span><a class="pep reference external" href="https://peps.python.org/pep-0386/"><strong>PEP 386</strong></a>.</p>
<p>If you want to use this with <a class="reference external" href="https://jenkins.io/index.html">Jenkins</a>, also checkout the <a class="reference internal" href="jenkins.html#jenkins-artifact-example"><span class="std std-ref">Access package artifacts between Jenkins jobs</span></a>.</p>
<section id="basepython-defaults-overriding">
<h3>basepython defaults, overriding<a class="headerlink" href="#basepython-defaults-overriding" title="永久链接至标题">¶</a></h3>
<p>For any <code class="docutils literal notranslate"><span class="pre">pyXY</span></code> test environment name the underlying <code class="docutils literal notranslate"><span class="pre">pythonX.Y</span></code> executable
will be searched in your system <code class="docutils literal notranslate"><span class="pre">PATH</span></code>. Similarly, for <code class="docutils literal notranslate"><span class="pre">jython</span></code> and
<code class="docutils literal notranslate"><span class="pre">pypy</span></code> the respective <code class="docutils literal notranslate"><span class="pre">jython</span></code> and <code class="docutils literal notranslate"><span class="pre">pypy-c</span></code> names will be looked for.
The executable must exist in order to successfully create <em>virtualenv</em>
environments. On Windows a <code class="docutils literal notranslate"><span class="pre">pythonX.Y</span></code> named executable will be searched in
typical default locations using the <code class="docutils literal notranslate"><span class="pre">C:\PythonXY\python.exe</span></code> pattern.</p>
<p>All other targets will use the system <code class="docutils literal notranslate"><span class="pre">python</span></code> instead. You can override any
of the default settings by defining the <a class="reference internal" href="../config.html#conf-basepython"><code class="xref std std-conf docutils literal notranslate"><span class="pre">basepython</span></code></a> variable in a
specific test environment section, for example:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[testenv:docs]</span><span class="w"></span>
<span class="na">basepython</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">python2.7</span><span class="w"></span>
</pre></div>
</div>
</section>
</section>
<section id="avoiding-expensive-sdist">
<h2>Avoiding expensive sdist<a class="headerlink" href="#avoiding-expensive-sdist" title="永久链接至标题">¶</a></h2>
<p>Some projects are large enough that running an sdist, followed by
an install every time can be prohibitively costly. To solve this,
there are two different options you can add to the <code class="docutils literal notranslate"><span class="pre">tox</span></code> section. First,
you can simply ask tox to please not make an sdist:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[tox]</span><span class="w"></span>
<span class="na">skipsdist</span><span class="o">=</span><span class="s">True</span><span class="w"></span>
</pre></div>
</div>
<p>If you do this, your local software package will not be installed into
the virtualenv. You should probably be okay with that, or take steps
to deal with it in your commands section:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[testenv]</span><span class="w"></span>
<span class="na">commands</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">python setup.py develop</span><span class="w"></span>
<span class="w">           </span><span class="na">pytest</span><span class="w"></span>
</pre></div>
</div>
<p>Running <code class="docutils literal notranslate"><span class="pre">setup.py</span> <span class="pre">develop</span></code> is a common enough model that it has its own
option:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[testenv]</span><span class="w"></span>
<span class="na">usedevelop</span><span class="o">=</span><span class="s">True</span><span class="w"></span>
</pre></div>
</div>
<p>And a corresponding command line option <code class="docutils literal notranslate"><span class="pre">--develop</span></code>, which will set
<code class="docutils literal notranslate"><span class="pre">skipsdist</span></code> to True and then perform the <code class="docutils literal notranslate"><span class="pre">setup.py</span> <span class="pre">develop</span></code> step at the
place where <code class="docutils literal notranslate"><span class="pre">tox</span></code> normally performs the installation of the sdist.
Specifically, it actually runs <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-e</span> <span class="pre">.</span></code> behind the scenes, which
itself calls <code class="docutils literal notranslate"><span class="pre">setup.py</span> <span class="pre">develop</span></code>.</p>
<p>There is an optimization coded in to not bother re-running the command if
<code class="docutils literal notranslate"><span class="pre">$projectname.egg-info</span></code> is newer than <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> or <code class="docutils literal notranslate"><span class="pre">setup.cfg</span></code>.</p>
</section>
<section id="understanding-invocationerror-exit-codes">
<h2>Understanding <code class="docutils literal notranslate"><span class="pre">InvocationError</span></code> exit codes<a class="headerlink" href="#understanding-invocationerror-exit-codes" title="永久链接至标题">¶</a></h2>
<p>When a command (defined by <code class="docutils literal notranslate"><span class="pre">commands</span> <span class="pre">=</span></code> in <code class="docutils literal notranslate"><span class="pre">tox.ini</span></code>) fails,
it has a non-zero exit code,
and an <code class="docutils literal notranslate"><span class="pre">InvocationError</span></code> exception is raised by <code class="docutils literal notranslate"><span class="pre">tox</span></code>:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>ERROR: InvocationError <span class="k">for</span> <span class="nb">command</span>
       <span class="s1">&#39;&lt;command defined in tox.ini&gt;&#39;</span> <span class="o">(</span>exited with code <span class="m">1</span><span class="o">)</span>
</pre></div>
</div>
<p>If the command starts with <code class="docutils literal notranslate"><span class="pre">pytest</span></code> or <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">test</span></code> for instance,
then the <a class="reference external" href="https://docs.pytest.org/en/latest/usage.html#possible-exit-codes">pytest exit codes</a> are relevant.</p>
<p>On unix systems, there are some rather <a class="reference external" href="http://www.faqs.org/docs/abs/HTML/exitcodes.html">common exit codes</a>.
This is why for exit codes larger than 128,
if a signal with number equal to <code class="docutils literal notranslate"><span class="pre">&lt;exit</span> <span class="pre">code&gt;</span> <span class="pre">-</span> <span class="pre">128</span></code> is found
in the <a class="reference external" href="https://docs.python.org/3/library/signal.html#module-signal" title="(在 Python v3.10)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">signal</span></code></a> module, an additional hint is given:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>ERROR: InvocationError <span class="k">for</span> <span class="nb">command</span>
       <span class="s1">&#39;&lt;command&gt;&#39;</span> <span class="o">(</span>exited with code <span class="m">139</span><span class="o">)</span>
Note: this might indicate a fatal error signal <span class="o">(</span><span class="m">139</span> - <span class="nv">128</span> <span class="o">=</span> <span class="m">11</span>: SIGSEGV<span class="o">)</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">&lt;command&gt;</span></code> is the command defined in <code class="docutils literal notranslate"><span class="pre">tox.ini</span></code>, with quotes removed.</p>
<p>The signal numbers (e.g. 11 for a segmentation fault) can be found in the
“Standard signals” section of the <a class="reference external" href="http://man7.org/linux/man-pages/man7/signal.7.html">signal man page</a>.
Their meaning is described in <a class="reference external" href="https://en.wikipedia.org/wiki/Signal_(IPC)#POSIX_signals">POSIX signals</a>.</p>
<p>Beware that programs may issue custom exit codes with any value,
so their documentation should be consulted.</p>
<p>Sometimes, no exit code is given at all.
An example may be found in <a class="reference external" href="https://github.com/pytest-dev/pytest-qt/issues/170">pytest-qt issue #170</a>,
where Qt was calling <code class="docutils literal notranslate"><span class="pre">abort()</span></code> instead of <code class="docutils literal notranslate"><span class="pre">exit()</span></code>.</p>
<div class="admonition seealso">
<p class="admonition-title">参见</p>
<p><a class="reference internal" href="basic.html#ignoring-exit-code"><span class="std std-ref">Ignoring a command exit code</span></a>.</p>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/img/tox.png" alt="Logo"/>
    
  </a>
</p>



<p class="blurb">standardise testing in Python</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=tox-dev&repo=tox&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>






<div id="searchbox" style="display: none">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="搜索" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>

<h3>quicklinks</h3>
<div style="text-align: left; font-size: 100%; vertical-align: middle;">
<table>
<tr>
<td>
        <a href="../index.html">home</a>
</td><td>
        <a href="../examples.html">examples</a>
</td></tr><tr><td>
        <a href="../install.html">install</a>
</td><td>
        <a href="../changelog.html">changelog</a>
</td></tr><tr><td>
        <a href="../config.html">config</a>
</td><td>
        <a href="https://github.com/tox-dev/tox/issues">issues[gh]</a>
</td></tr><tr><td>
        <a href="../support.html">support</a>
</td><td>
        <a href="../plugins.html">plugins/hooks</a>
</td>
</tr></table>
</div>

  <div>
    <h3><a href="../index.html">目录</a></h3>
    <ul>
<li><a class="reference internal" href="#">General tips and tricks</a><ul>
<li><a class="reference internal" href="#interactively-passing-positional-arguments">Interactively passing positional arguments</a></li>
<li><a class="reference internal" href="#dependency-changes-and-tracking">Dependency changes and tracking</a></li>
<li><a class="reference internal" href="#selecting-one-or-more-environments-to-run-tests-against">Selecting one or more environments to run tests against</a></li>
<li><a class="reference internal" href="#access-package-artifacts-between-multiple-tox-runs">Access package artifacts between multiple tox-runs</a><ul>
<li><a class="reference internal" href="#basepython-defaults-overriding">basepython defaults, overriding</a></li>
</ul>
</li>
<li><a class="reference internal" href="#avoiding-expensive-sdist">Avoiding expensive sdist</a></li>
<li><a class="reference internal" href="#understanding-invocationerror-exit-codes">Understanding <code class="docutils literal notranslate"><span class="pre">InvocationError</span></code> exit codes</a></li>
</ul>
</li>
</ul>

  </div><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../examples.html">tox configuration and usage examples</a><ul>
      <li>Previous: <a href="documentation.html" title="上一章">Generate documentation</a></li>
      <li>Next: <a href="jenkins.html" title="下一章">Using tox with the Jenkins Integration Server</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="转向" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2010-2022, holger krekel and others.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.5.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    
    <a href="https://github.com/tox-dev/tox" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>